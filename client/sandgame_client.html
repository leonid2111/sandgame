<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Simple grid</title>
  </head>
  <body>

    <div class="grid">
      <canvas id="canvas" height="400" width="500"></canvas>
    </div>
    
    <script>
      const canvas = document.getElementById('canvas');
      const ctx = canvas.getContext('2d');
	  const cellsize = 20;
	  const colors = {0:'white',1:'yellow',2:'red',3:'brown',4:'purple'}
	  var rows;
	  
	  function draw_grid(grid){
		  rows = grid.length;
		  for(let i=0; i<grid.length; i++){
			  for(let j=0; j<grid.length; j++){
				  ctx.strokeRect(i*cellsize, j*cellsize, cellsize, cellsize);
				  ctx.fillStyle = colors[grid[i][j]]
				  ctx.fillRect(i*cellsize, j*cellsize, cellsize, cellsize)
			  }
		  }
	  }

      function test_on_click_fn(event){
		  let x = event.pageX; let y = event.pageY;
		  if(x<rows*cellsize && y<rows*cellsize){
			  n1 = ~~(x/cellsize);
			  n2 = ~~(y/cellsize);
			  //socket.send(JSON.stringify({x: n1, y: n2}))
			  socket.send(JSON.stringify([n1, n2]))
			  
			  ctx.strokeRect(n1*cellsize, n2*cellsize, cellsize, cellsize)
			  ctx.fillStyle = 'blue'
			  ctx.fillRect(n1*cellsize, n2*cellsize, cellsize, cellsize)
		  }
      }
      
      var grid = document.querySelector(".grid");
      grid.addEventListener("click", test_on_click_fn, false);
	  
      
      let socket = new WebSocket("ws://127.0.0.1:8080/sandgame");
      console.log("Attempting Connection...");

	  socket.addEventListener('message', function (event) {
		  //console.log('Message from server ', JSON.parse(event.data));
		  grid = JSON.parse(JSON.parse(event.data));
		  console.log('Message from server ', grid);
		  draw_grid(grid)
		  /*coords = JSON.parse(msg);
		  //console.log('Message from server ', coords);
		  n1 = coords.x;
		  n2 = coords.y;
		  ctx.fillStyle = 'green';
		  ctx.fillRect(n1*cellsize, n2*cellsize, cellsize, cellsize);*/
	  });

	  
	  
      socket.onopen = () => {
          console.log("Successfully Connected");
          //socket.send("sandgame client connects")
      };
        
      socket.onclose = event => {
          console.log("Socket Closed Connection: ", event);
          //socket.send("sandgame client disconnects")
      };

      socket.onerror = error => {
          console.log("Socket Error: ", error);
      };

    </script>
  </body>
</html>
